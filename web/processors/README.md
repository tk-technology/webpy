# 处理器模块
###### 使用webpy进行Web项目开发的过程中，某些功能常被高频率使用，如：进行业务处理前先判断登录状态、业务处理结果结构化后使用json序列化等。特将此类功能设计为处理器，允许用户在业务处理底层按需调用。
###### 注意：添加处理器存在先后顺序

---

## 处理器清单
###### - Authenticate.py 身份验证处理器
###### - Convert.py：业务输出封装处理器
###### - ValidPath.py：非法路径重定向
###### - XssFilter.py：XSS过滤器
###### - SessionExpired.py：修正session过期方式

---

## 处理器介绍
### 身份验证处理器
#### 支持验证方式
###### IP白名单：不推荐使用
###### 签名：具备appId、timestamp和sign三个参数的请求使用签名进行身份验证，建议服务器间访问使用
###### session：其他请求通过账号密码登录后，使用session维护登录状态，并基于session进行身份验证，建议PC访问使用，未登录时访问除登录接口以外
###### 优先级：IP白名单 > 签名 > session
###### 注意：访问无效路径将被重定向至登录页面的接口时将重定向至登录静态页面。
#### 签名算法
###### 有序连接salt和URL参数（URL中的sign参数除外；均转换为小写；按key递增排列；使用空字符串连接），获取的md5摘要作为签名值。例如：
###### 假设原始接口URL为http://domain:port/path?b=1；appId=test且timestamp=1516004182；盐值为d74e53a397924be06351f06388e7067d
###### sign=md5('appIdtestb1saltd74e53a397924be06351f06388e7067dtimestamp1516004182')
###### 最终URL为http://domain:port/path?b=1&appId=test&timestamp=1516004182&sign=92abce8180f7e58303fd43be363a40e3

### 业务输出封装处理器
###### 使用json.dumps()将业务输出结果序列化，序列化失败返回HTTP500响应；允许捕获业务逻辑中触发的HTTPError子异常，并返回相应响应，因此可以自定义一些想要与前台交互的异常，如参数错误等
###### 身份验证处理器签名验证失败和session验证失败可以通过该处理器返回HTTP420响应和HTTP421响应

### 非法路径重定向
###### 将对不存在路径的访问重定向至登录页，避免进行后续处理。已有路径由数据库表得到，后续可以修改为递归查询子应用的方式，避免依赖数据库表。

### XSS过滤器
###### 废弃模板系统使用前后端分离的模式后，原有XSS过滤器失效，新增XSS过滤器。

### 修正session过期方式
###### webpy按照session创建时间计算过期，而不是按照最后一次访问时间，不合理，修改为按照最后一次访问时间开始计算登录超时。